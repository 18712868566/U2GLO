"use strict";

function _typeof(t) {
    return (_typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(t) {
        return typeof t;
    } : function(t) {
        return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t;
    })(t);
}

!function(t, e) {
    "object" == ("undefined" == typeof exports ? "undefined" : _typeof(exports)) && "undefined" != typeof module ? module.exports = e() : "function" == typeof define && define.amd ? define(e) : (t = "undefined" != typeof globalThis ? globalThis : t || self).Atropos = e();
}(void 0, function() {
    function D() {
        return (D = Object.assign || function(t) {
            for (var e = 1; e < arguments.length; e++) {
                var o, a = arguments[e];
                for (o in a) Object.prototype.hasOwnProperty.call(a, o) && (t[o] = a[o]);
            }
            return t;
        }).apply(this, arguments);
    }
    function F(t, e) {
        return t.querySelector(e);
    }
    return function(t) {
        var f, e, o, h, v, a, m, r, i, s, n, p, c, u = t = void 0 === t ? {} : t, y = u.el, g = u.eventsEl, l = {
            __atropos__: !0,
            params: D({
                alwaysActive: !1,
                activeOffset: 50,
                shadowOffset: 50,
                shadowScale: 1,
                duration: 300,
                rotate: !0,
                rotateTouch: !0,
                rotateXMax: 15,
                rotateYMax: 15,
                rotateXInvert: !1,
                rotateYInvert: !1,
                stretchX: 0,
                stretchY: 0,
                stretchZ: 0,
                commonOrigin: !0,
                shadow: !0,
                highlight: !0,
                onEnter: null,
                onLeave: null,
                onRotate: null
            }, (void 0 === (p = t || {}) && (p = {}), c = {}, Object.keys(p).forEach(function(t) {
                void 0 !== p[t] && (c[t] = p[t]);
            }), c)),
            destroyed: !1,
            isActive: !1
        }, M = l.params, x = [];
        !function t() {
            n = requestAnimationFrame(function() {
                x.forEach(function(t) {
                    var e, o;
                    "function" == typeof t ? t() : (e = t.element, o = t.prop, t = t.value, 
                    e.style[o] = t);
                }), x.splice(0, x.length), t();
            });
        }();
        function d(t, e, o, a) {
            t.addEventListener(e, o, a);
        }
        function b(t, e, o, a) {
            t.removeEventListener(e, o, a);
        }
        function w() {
            x.push(function() {
                return y.classList.add("atropos-active");
            }), E(f, M.duration + "ms"), R(f, "ease-out"), S(e, "translate3d(0,0, " + M.activeOffset + "px)"), 
            E(e, M.duration + "ms"), R(e, "ease-out"), a && (E(a, M.duration + "ms"), 
            R(a, "ease-out")), l.isActive = !0;
        }
        function O(t) {
            r = void 0, "pointerdown" === t.type && "mouse" === t.pointerType || "pointerenter" === t.type && "mouse" !== t.pointerType || ("pointerdown" === t.type && t.preventDefault(), 
            i = t.clientX, s = t.clientY, M.alwaysActive ? v = h = void 0 : (w(), 
            "function" == typeof M.onEnter && M.onEnter()));
        }
        function _(t) {
            !1 === r && t.cancelable && t.preventDefault();
        }
        function T(t) {
            if (M.rotate && l.isActive) {
                if ("mouse" !== t.pointerType) {
                    if (!M.rotateTouch) return;
                    t.preventDefault();
                }
                var e = t.clientX, o = t.clientY, a = e - i, n = o - s;
                "string" != typeof M.rotateTouch || 0 == a && 0 == n || void 0 !== r || (25 <= a * a + n * n && (n = 180 * Math.atan2(Math.abs(n), Math.abs(a)) / Math.PI, 
                r = "scroll-y" === M.rotateTouch ? 45 < n : 45 < 90 - n), !1 === r && (y.classList.add("atropos-rotate-touch"), 
                t.cancelable && t.preventDefault())), "mouse" !== t.pointerType && r || j(e, o);
            }
        }
        function X(t) {
            if (v = h = void 0, l.isActive && !(t && "pointerup" === t.type && "mouse" === t.pointerType || t && "pointerleave" === t.type && "mouse" !== t.pointerType)) {
                if ("string" == typeof M.rotateTouch && r && y.classList.remove("atropos-rotate-touch"), 
                M.alwaysActive) return j(), "function" == typeof M.onRotate && M.onRotate(0, 0), 
                void ("function" == typeof M.onLeave && M.onLeave());
                x.push(function() {
                    return y.classList.remove("atropos-active");
                }), E(e, M.duration + "ms"), R(e, ""), S(e, "translate3d(0,0, 0px)"), 
                a && (E(a, M.duration + "ms"), R(a, "")), m && (E(m, M.duration + "ms"), 
                R(m, ""), S(m, "translate3d(0, 0, 0)"), I(m, 0)), E(f, M.duration + "ms"), 
                R(f, ""), S(f, "translate3d(0,0,0) rotateX(0deg) rotateY(0deg)"), 
                P({
                    duration: M.duration + "ms"
                }), l.isActive = !1, "function" == typeof M.onRotate && M.onRotate(0, 0), 
                "function" == typeof M.onLeave && M.onLeave();
            }
        }
        function Y(t) {
            t = t.target, !g.contains(t) && t !== g && l.isActive && X();
        }
        var L, A, E = function(t, e) {
            x.push({
                element: t,
                prop: "transitionDuration",
                value: e
            });
        }, R = function(t, e) {
            x.push({
                element: t,
                prop: "transitionTimingFunction",
                value: e
            });
        }, S = function(t, e) {
            x.push({
                element: t,
                prop: "transform",
                value: e
            });
        }, I = function(t, e) {
            x.push({
                element: t,
                prop: "opacity",
                value: e
            });
        }, P = function(t) {
            var e = t.rotateXPercentage, n = void 0 === e ? 0 : e, e = t.rotateYPercentage, r = void 0 === e ? 0 : e, i = t.duration, s = t.opacityOnly, p = t.easeOut;
            y.querySelectorAll("[data-atropos-offset], [data-atropos-opacity]").forEach(function(t) {
                E(t, i), R(t, p ? "ease-out" : "");
                var e, o, a = function(t) {
                    if (t.dataset.atroposOpacity && "string" == typeof t.dataset.atroposOpacity) return t.dataset.atroposOpacity.split(";").map(function(t) {
                        return parseFloat(t);
                    });
                }(t);
                0 === n && 0 === r ? (s || S(t, "translate3d(0, 0, 0)"), a && I(t, a[0])) : (e = parseFloat(t.dataset.atroposOffset) / 100, 
                Number.isNaN(e) || s || S(t, "translate3d(" + -r * -e + "%, " + n * -e + "%, 0)"), 
                a && (e = a[0], a = a[1], o = Math.max(Math.abs(n), Math.abs(r)), 
                I(t, e + (a - e) * o / 100)));
            });
        }, j = function(t, e) {
            var o = y !== g;
            h = h || y.getBoundingClientRect(), o && !v && (v = g.getBoundingClientRect()), 
            void 0 === t && void 0 === e && (t = (n = o ? v : h).left + n.width / 2, 
            e = n.top + n.height / 2);
            var a, n = 0, r = 0, i = h, s = i.top, p = i.left, c = i.width, i = i.height;
            o ? (l = (d = v).top, a = d.left, u = d.width, d = d.height, r = M.rotateYMax * (t - a - (c / 2 + (p - a))) / (u - c / 2) * -1, 
            n = M.rotateXMax * (e - l - (i / 2 + (s - l))) / (d - i / 2), a = t - p + "px " + (e - s) + "px") : (r = M.rotateYMax * (t - p - c / 2) / (c / 2) * -1, 
            n = M.rotateXMax * (e - s - i / 2) / (i / 2)), n = Math.min(Math.max(-n, -M.rotateXMax), M.rotateXMax), 
            M.rotateXInvert && (n = -n), r = Math.min(Math.max(-r, -M.rotateYMax), M.rotateYMax), 
            M.rotateYInvert && (r = -r);
            var u = n / M.rotateXMax * 100, l = r / M.rotateYMax * 100, d = (o ? l / 100 * M.stretchX : 0) * (M.rotateYInvert ? -1 : 1), t = (o ? u / 100 * M.stretchY : 0) * (M.rotateXInvert ? -1 : 1), p = o ? Math.max(Math.abs(u), Math.abs(l)) / 100 * M.stretchZ : 0;
            S(f, "translate3d(" + d + "%, " + -t + "%, " + -p + "px) rotateX(" + n + "deg) rotateY(" + r + "deg)"), 
            a && M.commonOrigin && (c = f, e = a, x.push({
                element: c,
                prop: "transformOrigin",
                value: e
            })), m && (E(m, M.duration + "ms"), R(m, "ease-out"), S(m, "translate3d(" + .25 * -l + "%, " + .25 * u + "%, 0)"), 
            I(m, Math.max(Math.abs(u), Math.abs(l)) / 100)), P({
                rotateXPercentage: u,
                rotateYPercentage: l,
                duration: M.duration + "ms",
                easeOut: !0
            }), "function" == typeof M.onRotate && M.onRotate(n, r);
        };
        return l.destroy = function() {
            l.destroyed = !0, cancelAnimationFrame(n), b(document, "click", Y), 
            b(g, "pointerdown", O), b(g, "pointerenter", O), b(g, "pointermove", T), 
            b(g, "touchmove", _), b(g, "pointerleave", X), b(g, "pointerup", X), 
            b(g, "lostpointercapture", X), delete y.__atropos__;
        }, !(y = "string" == typeof y ? F(document, y) : y) || y.__atropos__ || (void 0 !== g ? "string" == typeof g && (g = F(document, g)) : g = y, 
        Object.assign(l, {
            el: y
        }), f = F(y, ".atropos-rotate"), e = F(y, ".atropos-scale"), o = F(y, ".atropos-inner"), 
        y.__atropos__ = l), y && g && (M.shadow && ((a = F(y, ".atropos-shadow")) || ((a = document.createElement("span")).classList.add("atropos-shadow"), 
        L = !0), S(a, "translate3d(0,0,-" + M.shadowOffset + "px) scale(" + M.shadowScale + ")"), 
        L && f.appendChild(a)), M.highlight && ((m = F(y, ".atropos-highlight")) || ((m = document.createElement("span")).classList.add("atropos-highlight"), 
        A = !0), S(m, "translate3d(0,0,0)"), A && o.appendChild(m)), M.rotateTouch && ("string" == typeof M.rotateTouch ? y.classList.add("atropos-rotate-touch-" + M.rotateTouch) : y.classList.add("atropos-rotate-touch")), 
        F(y, "[data-atropos-opacity]") && P({
            opacityOnly: !0
        }), d(document, "click", Y), d(g, "pointerdown", O), d(g, "pointerenter", O), 
        d(g, "pointermove", T), d(g, "touchmove", _), d(g, "pointerleave", X), d(g, "pointerup", X), 
        d(g, "lostpointercapture", X), M.alwaysActive && (w(), j())), l;
    };
});